<!DOCTYPE html>
<html>
<head>
    <title><%= title %></title>
    <link rel="stylesheet" href="/stylesheets/product-detail.style.css"/>
    <link rel="stylesheet" href="/stylesheets/style.css" />
    <link rel="stylesheet" href="/stylesheets/currency-picker.style.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

</head>

<body>
<header>
    <div class="topnav">
        <a class="title" href="http://localhost/"><%= title%></a>
        <a href="http://localhost/categories/men">Men</a>
        <a href="http://localhost/categories/women">Women</a>
        <a href="#signin" class="signin">Sign In</a>
        <a href="#signup" class="signup">Sign Up</a>
    </div>
</header>
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item active" aria-current="page">Home</li>
        <li class="breadcrumb-item active" aria-current="page"><a href="http://localhost/categories/<%=varlink%>"><%=category %></a></li>
        <li class="breadcrumb-item active" aria-current="page"><a href="http://localhost/categories/<%=varlink%>/<%=parentcategory.toLowerCase()%>"><%=parentcategory %></a></li>
        <li class="breadcrumb-item" aria-current="page"><%=type %></li>
    </ol>
</nav>
<div>
    <% _.each(items, function(topC) { %>
        <% if (topC.image_groups) { %>
            <%for(let img of topC.image_groups){%>
        <%if(img.view_type==="large" && !img.variation_value){%>
        <div class="detail-container">
            <div class="img-container">
                <img src="/images/<%= img.images[0].link %>" alt="<%=topC.name%>">
            </div>
            <div class="text-container">
                <span class="h-title"><%= topC.name %></span>
                <p class="description"><%= topC.long_description %></p>
                <div class="footer">
                    <button class="button">Add to Cart</button>
                    <select name="currency" class="selector" id="currencySelector">
                        <option value="usd">USD</option>
                        <option value="eur">EURO</option>
                        <option value="try">TRY</option>
                        <option value="gbp">GBP</option>
                    </select>
                    <div class="price" id="price"><%=topC.price%></div>
                    <span class="price_text">Price: </span>
                </div>
            </div>
            <%}%>
            <%}%>

            <div class="variant" id="variant">
            <p class="var-title">Product Variants:</p>
            <%for(let va of topC.variation_attributes){%>
            <p class="subtitle"><b><%=va.name%></b></p>
                <%if(va.id==='color'){%>
                <div class="varColor" id="varColor">
                    <%for(let nm of va.values){%>
                    <button value="<%=nm.value%>" class="varButtonColor" id="var-button"><%=nm.name%></button>
                    <%}%>
                </div>
                <%}%>
                <%if(va.id==='size'){%>
                <div class="varSize" id="varSize">
                    <%for(let nm of va.values){%>
                    <button value="<%=nm.value%>" class="varButtonSize" id="var-button"><%=nm.name%></button>
                    <%}%>
                </div>
                <%}%>


            <%}%>
        </div>
        </div>

    <%}%>
    <%});%>
</div>
<footer>
    <div class="botnav">
        <a class="title"><%= title%> @2021</a>
    </div>
</footer>

<script src="/javascripts/jquery-3.6.0.min.js" type="text/javascript"></script>
<script>
    var selector = document.getElementById("currencySelector");
    var currencyElements = document.getElementById("price");
    var oldPrice=currencyElements.innerText

    $(document).ready(function (){
        $("#currencySelector").change(function (){
            $.ajax({
                url: 'https://api.exchangerate-api.com/v4/latest/USD',
                type:'GET',
                dataType:'json',
                success:function (data,textStatus,xhr){
                    var usdChangeRate = data.rates
                    oldPrice=parseFloat(oldPrice)
                        if(selector.value.toUpperCase() in usdChangeRate) {
                            var temp=selector.value.toUpperCase();
                            document.getElementById("price").innerText = Math.round(oldPrice*usdChangeRate[temp]).toString()
                        }
                },
                error: function () {
                   alert("An error occurred!")
                }
            })
        })
    })

</script>

<script>

    var SzbtnContainer=document.getElementById("varSize");
    var sizeBtns  = SzbtnContainer.getElementsByClassName("varButtonSize");

    var btnContainer = document.getElementById("varColor");
    var colorBtns = btnContainer.getElementsByClassName("varButtonColor");

    for (var i = 0; i < colorBtns.length; i++) {
        console.log("ben colorum")
        colorBtns[i].addEventListener("click", function() {
            console.log(1)
            var current = btnContainer.getElementsByClassName("selected");
            if (current.length > 0) {
                current[0].className = current[0].className.replace(" selected", "");
            }

            // Add the active class to the current/clicked button
            this.className += " selected";
        });
    }

    for (var j = 0; j < sizeBtns.length; j++) {
        console.log("ben size'Ä±m")
        sizeBtns[j].addEventListener("click", function() {
            console.log(2)
            var current = SzbtnContainer.getElementsByClassName("selected");

            if (current.length > 0) {
                current[0].className = current[0].className.replace(" selected", "");
            }

            this.className += " selected";
        });
    }

</script>



</body>
</html>
